!function(o,a){"use strict";var e=o.MediaWidgetModel.extend({}),t=o.MediaWidgetControl.extend({renderPreview:function(){var e,t,o=this;(o.model.get("attachment_id")||o.model.get("url"))&&(e=o.$el.find(".media-widget-preview"),t=wp.template("wp-media-widget-image-preview"),e.html(t(_.extend(o.previewTemplateProps.toJSON()))))},editMedia:function(){var t,e,o=this,i=o.mapModelToMediaFrameProps(o.model.toJSON());"none"===i.link&&(i.linkUrl=""),(t=wp.media({frame:"image",state:"image-details",metadata:i})).$el.addClass("media-widget"),i=function(){var e=t.state().attributes.image.toJSON();o.selectedAttachment.set(e),o.model.set(_.extend(o.mapMediaToModelProps(e),{error:!1}))},t.state("image-details").on("update",i),t.state("replace-image").on("replace",i),e=wp.media.model.Attachment.prototype.sync,wp.media.model.Attachment.prototype.sync=function(){return a.Deferred().rejectWith(this).promise()},t.on("close",function(){t.detach(),wp.media.model.Attachment.prototype.sync=e}),t.open()},getEmbedResetProps:function(){return _.extend(o.MediaWidgetControl.prototype.getEmbedResetProps.call(this),{size:"full",width:0,height:0})},getModelPropsFromMediaFrame:function(e){return _.omit(o.MediaWidgetControl.prototype.getModelPropsFromMediaFrame.call(this,e),"image_title")},mapModelToPreviewTemplateProps:function(){var e=this.model.get("url"),t=o.MediaWidgetControl.prototype.mapModelToPreviewTemplateProps.call(this);return t.currentFilename=e?e.replace(/\?.*$/,"").replace(/^.+\//,""):"",t}});o.controlConstructors.media_image=t,o.modelConstructors.media_image=e}(wp.mediaWidgets,jQuery);